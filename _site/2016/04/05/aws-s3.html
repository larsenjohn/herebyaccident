<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Where all of the tragic happens. You should really turn back now.">
    <meta name="author" content="">

    <!-- FB -->
  	<meta property="og:title" content="..." />
  	<meta property="og:site_name" content="..."/>
  	<meta property="og:url" content="http://..." />
  	<meta property="og:description" content="..." />
  	<meta property="og:type" content="article" />
  	<meta property="og:image" content="http://..." />
  	<meta property="og:image:type" content="/images/jpeg" />
  	<meta property="og:image:width" content="1200" />
  	<meta property="og:image:height" content="650" />

  	<!-- FB alt translations -->
  	<meta property="og:locale" content="en_US" />

    <title>
      
        AWS S3 Static Setup
      
    </title>

    <!-- fav and touch -->
    <link rel="shortcut icon" type="image/png" href="/favicon.png?">

    <!-- CSS -->
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <link href='https://fonts.googleapis.com/css?family=Ubuntu:400,300,500' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300,300italic,400italic,600,600italic' rel='stylesheet' type='text/css'>
    <link href="/css/libs/font-awesome.min.css" rel="stylesheet">
    <link href="/css/styles.css" rel="stylesheet">

    <!-- JS -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body>

  
<!-- Basic nav -->

<nav id="mainnav" class="navbar navbar-default navbar-fixed-top">
  <div class="container">

    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <a class="navbar-brand" href="/index.html"><i class="fa fa-bug" aria-hidden="true"></i> This incident will be reported</a>
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      </button>
    </div>
    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav navbar-right">
        <li>
          <a href="/blog.html">Adventures in bullshit <i class="fa fa-terminal" aria-hidden="true"></i></a>
        </li>
      </ul>
    </div><!-- /.navbar-collapse -->

  </div>
</nav>


  <div class="post">

    <div class="container push">
      <div class="row">

        <div class="col-sm-9">
          <h1 id="configure-a-static-site-through-aws-s3">Configure a static site through AWS S3</h1>

<p>It’s super cheap. That is until you get a bill that says it isn’t. Doesn’t matter, since Amazon already has your credit card on file so you will pay either way.</p>

<p>The whole <a href="http://docs.aws.amazon.com/AmazonS3/latest/dev/HostingWebsiteOnS3Setup.html">sad state of affairs is here to read.</a></p>

<p>So let’s get going shall we?</p>

<hr />
<hr class="rule" />

<h2 id="create-three-buckets">Create three buckets</h2>

<p>The site will need three instances. root, www, and logs. Create a bucket for each with the exact domain name.</p>

<p>For instance:</p>

<ul>
  <li>fucktheweb.com</li>
  <li>www.fucktheweb.com</li>
  <li>logs.fucktheweb.com</li>
</ul>

<p>Enable the root site <em>fucktheweb.com</em> for web hosting. Go to the <strong>Properties</strong> panel, click <strong>Static Website Hosting</strong>, and do the following:</p>

<ol>
  <li>Select the <strong>Enable website hosting</strong>.</li>
  <li>In the <strong>Index Document</strong> box, add index.html.</li>
  <li>In the <strong>Error Document</strong> box, add 404.html.</li>
</ol>

<hr />

<h2 id="make-the-root-public">Make the root public</h2>

<p>In the <em>fucktheweb.com</em> bucket <strong>Properties</strong> panel, click the <strong>Permissions</strong>.</p>

<ol>
  <li>Click Add <strong>Bucket Policy</strong>.</li>
  <li>Drop this puppy in</li>
</ol>

<pre>
{
  "Version":"2012-10-17",
  "Statement":[{
	"Sid":"PublicReadForGetBucketObjects",
        "Effect":"Allow",
	  "Principal": "*",
      "Action":["s3:GetObject"],
      "Resource":["arn:aws:s3:::fucktheweb.com/*"
      ]
    }
  ]
}
</pre>

<hr />

<h2 id="set-up-the-redirect">Set up the redirect</h2>

<p>In the <em>www.fucktheweb.com</em> bucket <strong>Properties</strong> go to <strong>Static Website Hosting</strong>.</p>

<ol>
  <li>Select <strong>Redirect all requests to another host name</strong></li>
  <li><strong>Redirect all requests to:</strong> fucktheweb.com</li>
</ol>

<hr />

<h2 id="set-up-logging">Set up logging</h2>

<p>In the <em>logs.fucktheweb.com</em> bucket, create a folder named “root”.</p>

<p>In the <em>fucktheweb.com</em> bucket <strong>Properties</strong> panel, click <strong>Logging</strong>.</p>

<ol>
  <li>Check <strong>Enable logging</strong>.</li>
  <li><strong>Target bucket:</strong> logs.fucktheweb.com</li>
  <li><strong>Target prefix:</strong> root/</li>
</ol>

<hr />
<hr />

<h1 id="point-the-domain">Point the domain</h1>

<p>Well, that was fun. Now we get to go through another super groovy interface that costs more money. It’s Amazon’s signature “Route 53” and we need to set up a “hosted zone”.</p>

<hr />

<h2 id="create-a-new-hosted-zone">Create a new hosted zone</h2>

<p>In Route 53, go to <strong>Hosted zones</strong> and <strong>create a new hosted zone</strong> called fucktheweb.com. This will generate the namesevers. These nameservers are not consistent when generated, so if you botch it and start over, make sure to check them again before you point. You’ll also need to <strong>config two new A records in Route 53</strong> because simple nameservers would be too easy.</p>

<hr />

<h2 id="create-a-root-a-record">Create a root A record</h2>

<p>In the new fucktheweb.com hosted zone, <strong>create a record set</strong>.</p>

<ol>
  <li><strong>Name:</strong> leave blank</li>
  <li><strong>Type:</strong> A - IPv4 address</li>
  <li><strong>Alias:</strong> <em>- S3 website endpoints -</em> fucktheweb.com (s3-website-…)</li>
  <li><strong>Routing Policy:</strong> Simple</li>
</ol>

<hr />

<h2 id="create-a-www-a-record">Create a www. A record</h2>

<ol>
  <li><strong>Name:</strong> www</li>
  <li><strong>Type:</strong> A - IPv4 address</li>
  <li><strong>Alias:</strong> <em>- S3 website endpoints -</em> fucktheweb.com (s3-website-…)</li>
  <li><strong>Routing Policy:</strong> Simple</li>
</ol>

<hr />
<hr />

<h1 id="change-nameservers">Change Nameservers</h1>

<p>Now go to the registrar and use the Route 53 generated Nameservers to point the domain to S3.</p>

        </div>

        <div class="col-sm-3 sidenav">
          <h3>Failures</h3>
          <hr class="heading">
          <ul>
            
            <li>
              <a href="/2016/04/20/simple-xml-sitemap.html">XML simple sitemap</a>
            </li>
            
            <li>
              <a href="/2016/04/20/jekyll-site-hosted-on-github.html">Github pages hosting</a>
            </li>
            
            <li>
              <a href="/2016/04/20/common-analytics-settings.html">Analytics starter settings</a>
            </li>
            
            <li>
              <a href="/2016/04/18/youtube-custom-transcriptions.html">Youtube custom transcriptions</a>
            </li>
            
            <li>
              <a href="/2016/04/18/aws-ec2-easy-engine.html">AWS EC2 LEMP stack</a>
            </li>
            
            <li>
              <a href="/2016/04/15/vagrant-scotchbox.html">Vagrant Scotchbox LAMP stack</a>
            </li>
            
            <li>
              <a href="/2016/04/15/open-vpn-el-capitan-bug.html">Open VPN El Capitan bug</a>
            </li>
            
            <li>
              <a href="/2016/04/15/common-css.html">Common CSS</a>
            </li>
            
            <li>
              <a href="/2016/04/05/osx-setup.html">OSX setup</a>
            </li>
            
            <li>
              <a href="/2016/04/05/global-git-ignore.html">Global .gitignore</a>
            </li>
            
            <li>
              <a href="/2016/04/05/basic-linux-commands.html">Linux basics</a>
            </li>
            
            <li>
              <a href="/2016/04/05/aws-s3.html">AWS S3 Static Setup</a>
            </li>
            
            <li>
              <a href="/2016/04/04/markdown.html">Markdown / Kramdown</a>
            </li>
            
          </ul>
        </div>

      </div>
    </div>

  </div>

  
<footer>

  <div class="container">
    <div class="row">
      <div class="col-sm-12">

      <hr>
      <p class="text-center">It's 2016 in case you live on the moon.</p>

      </div>
    </div>
  </div>

</footer><!-- footer -->


  <!-- JS -->


</body>
