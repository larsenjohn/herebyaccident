---
layout: post
category: post
title: AWS S3 Static Setup
published: true
---

# Configure a static site through AWS S3

It's super cheap. That is until you get a bill that says it isn't. Doesn't matter, since Amazon already has your credit card on file so you will pay either way.

The whole [sad state of affairs is here to read.](http://docs.aws.amazon.com/AmazonS3/latest/dev/HostingWebsiteOnS3Setup.html)

So let's get going shall we?

***
<hr class="rule">

## Create three buckets

The site will need three instances. root, www, and logs. Create a bucket for each with the exact domain name.

For instance:

+ fucktheweb.com
+ www.fucktheweb.com
+ logs.fucktheweb.com

Enable the root site *fucktheweb.com* for web hosting. Go to the **Properties** panel, click **Static Website Hosting**, and do the following:

1. Select the **Enable website hosting**.
2. In the **Index Document** box, add index.html.
3. In the **Error Document** box, add 404.html.

![Enable website hosting](/images/ref/aws-enable-website-hosting.jpg)

***

## Make the root public

In the *fucktheweb.com* bucket **Properties** panel, click the **Permissions**.

1. Click Add **Bucket Policy**.
2. Drop this puppy in

<pre>
{
  "Version":"2012-10-17",
  "Statement":[{
	"Sid":"PublicReadForGetBucketObjects",
        "Effect":"Allow",
	  "Principal": "*",
      "Action":["s3:GetObject"],
      "Resource":["arn:aws:s3:::fucktheweb.com/*"
      ]
    }
  ]
}
</pre>

***

## Set up the redirect

In the *www.fucktheweb.com* bucket **Properties** go to **Static Website Hosting**.

1. Select **Redirect all requests to another host name**
2. **Redirect all requests to:** fucktheweb.com

![Set up redirect](/images/ref/aws-redirect.jpg)

***

## Enable logging

In the *logs.fucktheweb.com* bucket, create a folder named "root".

In the *fucktheweb.com* bucket **Properties** panel, click **Logging**.

1. Check **Enabled**.
2. **Target bucket:** logs.fucktheweb.com
3. **Target prefix:** root/

![Enable logging](/images/ref/aws-enable-logging.jpg)

***

# Point the domain

Well, that was fun. Now we get to go through another super groovy interface that costs more money. It's Amazon's signature "Route 53" and we need to set up a "hosted zone". Well, it's not *that* expensive. But if you want to use any fancy cloud stuff thier signature cloudfront stuff *is* expensive. Or, at least I think so. I have no way of telling since their "calculator" is a giant clusterfuck. 

You can alternately use [cloudflare](https://www.cloudflare.com/), where you can roll a freebie one site version that includes routing *and* provides a little compression juice for speed. Prices don't appear bad and they also seem sensitive for DDOS attacks. They also boast free SSL, which seems kind of impossible.

***
***

# Route 53 way

In Route 53, go to **Hosted zones** and **create a new hosted zone** called fucktheweb.com. This will generate the namesevers. These nameservers are not consistent when generated, so if you botch it and start over, make sure to check them again before you point. You'll also need to **config two new A records in Route 53** because simple nameservers would be too easy.

***

## Create a root A record

In the new fucktheweb.com hosted zone, **create a record set**.

1. **Name:** leave blank
2. **Type:** A - IPv4 address
3. **Alias:** *- S3 website endpoints -* fucktheweb.com (s3-website-...)
4. **Routing Policy:** Simple

***

## Create a www. A record

1. **Name:** www
2. **Type:** A - IPv4 address
3. **Alias:** *- S3 website endpoints -* fucktheweb.com (s3-website-...)
4. **Routing Policy:** Simple

***

## Change Nameservers

Now go to the registrar and use the Route 53 generated Nameservers to point the domain to S3.

***

# Cloudflare way

Do the account hoops and login. Then run the scan on the domain you want to route.

## Cut the auto records

I read somewhere you don't need the A records this thing generates. So, I didn't. This may be a total mistake.

***

## Add two CNAMEs

Add one titled fucktheweb.com, and one titled www. Just use the defualts for everything else. You should be set for www forwarding from the S3 config and this shouldn't rely on any Route 53 support.

***

## Activate records

Theoretically, you should only need the two CNAMES to hook this up. I have no idea how and MX stuff works, so don't cry to me about it now. Select the little cloud icon and make sure it turns orange or whatever it needs to move the dial. Then you can go through and push buttons and see how everything works.

***

## Change nameservers

Now go to the registrar and use the cloudflare generated Nameservers to point the domain to S3.
